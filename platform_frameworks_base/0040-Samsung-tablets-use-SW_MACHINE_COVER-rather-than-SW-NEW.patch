From be3bb0f05a84fdba16a518bfbe8dad70eb3e13a7 Mon Sep 17 00:00:00 2001
From: harvey186 <harvey186@hotmail.com>
Date: Thu, 4 Dec 2025 12:47:16 +0100
Subject: [PATCH] Samsung-tablets-use-SW_MACHINE_COVER-rather-than-SW-NEW

Change-Id: Ib4b656d9f8c63ea59d95f13774b5d29536c50c61
---
 0039-correction-ProcessList.java-New.patch    | 27 +++++++++++++++++++
 .../server/input/InputManagerService.java     |  9 +++----
 2 files changed, 30 insertions(+), 6 deletions(-)
 create mode 100644 0039-correction-ProcessList.java-New.patch

diff --git a/0039-correction-ProcessList.java-New.patch b/0039-correction-ProcessList.java-New.patch
new file mode 100644
index 000000000..492110478
--- /dev/null
+++ b/0039-correction-ProcessList.java-New.patch
@@ -0,0 +1,27 @@
+From 2030df2dfd43e79853524c6015138a4ce66d3a14 Mon Sep 17 00:00:00 2001
+From: harvey186 <harvey186@hotmail.com>
+Date: Thu, 4 Dec 2025 12:00:33 +0100
+Subject: [PATCH] correction ProcessList.java-New
+
+Change-Id: I7e1ffa11fe7fcb93c8f62c92b42e32e0f0613818
+---
+ .../com/android/server/am/ProcessList.java    |  2 +-
+ 1 files changed, 1 insertions(+), 0 deletions(-)
+
+
+diff --git a/services/core/java/com/android/server/am/ProcessList.java b/services/core/java/com/android/server/am/ProcessList.java
+index e89aed212..3335111c4 100644
+--- a/services/core/java/com/android/server/am/ProcessList.java
++++ b/services/core/java/com/android/server/am/ProcessList.java
+@@ -2626,7 +2626,7 @@ public final class ProcessList implements ProcessStateController.ProcessLruUpdat
+                         }
+                     }
+                 }
+-            }
++            
+ 
+             // This runs after Process.start() as this method may block app process starting time
+             // if dir is not cached. Running this method after Process.start() can make it
+-- 
+2.34.1
+
diff --git a/services/core/java/com/android/server/input/InputManagerService.java b/services/core/java/com/android/server/input/InputManagerService.java
index 197f3ada4..2f3b811e7 100644
--- a/services/core/java/com/android/server/input/InputManagerService.java
+++ b/services/core/java/com/android/server/input/InputManagerService.java
@@ -442,7 +442,6 @@ public class InputManagerService extends IInputManager.Stub
 
     /** Switch code: Microphone. When set, the mic is muted. */
     public static final int SW_MUTE_DEVICE = 0x0e;
-
     /** Switch code: Cover. When set, the cover is closed. */
     public static final int SW_MACHINE_COVER = 0x10;
     // Samsung
@@ -463,7 +462,6 @@ public class InputManagerService extends IInputManager.Stub
     public static final int SW_MUTE_DEVICE_BIT = 1 << SW_MUTE_DEVICE;
     public static final int SW_MACHINE_COVER_BIT = 1 << SW_MACHINE_COVER;
     private int mSwForLid = SW_LID;
-
     // The following are layer numbers used for z-ordering the input overlay layers on the display.
     // This is used for ordering layers inside {@code DisplayContent#getInputOverlayLayer()}.
     //
@@ -627,8 +625,7 @@ public class InputManagerService extends IInputManager.Stub
                 android.util.Log.e("PHH", "Not found a SW_FLIP");
             }
             android.util.Log.e("PHH", "Switch state got " + machineCoverState + " and " + flip);
-    }
-
+     }
     void registerLidSwitchCallbackInternal(@NonNull LidSwitchCallback callback) {
         synchronized (mLidSwitchLock) {
             mLidSwitchCallbacks.add(callback);
@@ -682,7 +679,8 @@ public class InputManagerService extends IInputManager.Stub
 
             // Send the initial lid switch state to any callback registered before the system was
             // ready.
-            int switchState = getSwitchState(-1 /* deviceId */, InputDevice.SOURCE_ANY, SW_LID);
+            checkForSwMachineCover();
+            int switchState = getSwitchState(-1 /* deviceId */, InputDevice.SOURCE_ANY, mSwForLid);
             for (int i = 0; i < mLidSwitchCallbacks.size(); i++) {
                 LidSwitchCallback callback = mLidSwitchCallbacks.get(i);
                 callback.notifyLidSwitchChanged(0 /* whenNanos */, switchState == KEY_STATE_UP);
@@ -2532,7 +2530,6 @@ public class InputManagerService extends IInputManager.Stub
                     + ", mask=" + Integer.toHexString(switchMask));
         }
 
-        if ((switchMask & SW_LID_BIT) != 0) {
         if ((switchMask & (1 << mSwForLid)) != 0) {
             final boolean lidOpen = ((switchValues & (1 << mSwForLid)) == 0);
             synchronized (mLidSwitchLock) {
-- 
2.34.1

