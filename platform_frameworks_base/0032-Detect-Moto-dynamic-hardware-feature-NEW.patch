From 298489a08e1b5a1144f255ff7ed89b113a3c62a0 Mon Sep 17 00:00:00 2001
From: harvey186 <harvey186@hotmail.com>
Date: Wed, 3 Dec 2025 15:55:16 +0100
Subject: [PATCH] 0032-Detect-Moto-dynamic-hardware-feature

Change-Id: Iecf96f78a293e788daf4813ac37a335be8b80045
---
 .../java/com/android/server/SystemConfig.java | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/services/core/java/com/android/server/SystemConfig.java b/services/core/java/com/android/server/SystemConfig.java
index 2dca73ff7..71b1e625d 100644
--- a/services/core/java/com/android/server/SystemConfig.java
+++ b/services/core/java/com/android/server/SystemConfig.java
@@ -1066,6 +1066,25 @@ public class SystemConfig {
                                         + parser.getPositionDescription());
                         XmlUtils.skipCurrentTag(parser);
                         break;
+                    case "unavailable-feature-conditional": {
+                        if (allowFeatures) {
+                            String fname = parser.getAttributeValue(null, "name");
+                            String prop = parser.getAttributeValue(null, "prop");
+                            if (fname == null || prop == null) {
+                                Slog.w(TAG, "<" + name + "> without name in " + permFile
+                                        + " at " + parser.getPositionDescription());
+                            } else {
+                                if(android.os.SystemProperties.getBoolean(prop, false)) {
+                                    addFeature(fname, 0);
+                                } else {
+                                    mUnavailableFeatures.add(fname);
+                                }
+                            }
+                        } else {
+                            logNotAllowedInPartition(name, permFile, parser);
+                        }
+                        XmlUtils.skipCurrentTag(parser);
+                    } break;                        
                 }
             }
         } catch (XmlPullParserException e) {
-- 
2.34.1

